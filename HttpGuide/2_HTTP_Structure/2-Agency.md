# HTTP结构

## 代理

### 什么是Web代理服务器

Web代理（proxy）服务器是网络的中间实体，代理位于客户端与服务器之间，扮演中间人角色，在各端点之间来回传送HTTP报文，代理既是服务器，也是客户端

### 代理与网关的区别

严格来说   
代理连接的是两个或多个使用相同协议的应用程序， 代理扮演的是 中间人 角色   
网关连接的是两个或多个使用不同协议的端点，网关扮演的是 协议转换器 角色

实际上，代理与网关区别很模糊，代理有时候会实现网关的功能

### 代理提供的帮助

1. 儿童过滤器 --- 内容过滤
2. 文档访问控制 --- 访问控制
3. 安全防火墙 --- 清除病毒等危险程序，提高安全性
4. Web缓存 --- 维护常用文档的本地副本，减少缓慢且昂贵的因特网通信
5. 反向代理 --- 按需定位所请求的内容，根据请求内容代理到不同的服务器
6. 内容路由器 --- 根据因特网流量状态以及内容类型将请求导向特定的web服务器
7. 转码器 --- 在内容发送给客户端之前，修改内容的主体格式
8. 匿名者 --- 从HTTP报文中删除身份特性

### 现实网络怎样部署代理

1. 出口代理 --- 将代理固定在本地网络的出口点，以便控制本地网络与大型因特网之间的流量，作为内容过滤，访问控制
2. 入口代理 --- 将代理放在ISP访问点上，用以处理来自客户端的聚合请求，作为缓存代理服务器
3. 反向代理 --- 将代理部署在网络边缘，在web服务器之前，作为服务器的替代者冒用web服务器的名字和IP地址，处理所有传送给Web服务器的请求，并只在必要时向Web服务器请求资源
4. 网络交换代理 --- 对流量进行监控

### 如何将网络流量导向代理服务器

1. 修改客户端 --- 手动配置客户端的代理配置
2. 修改网络 --- 在用户不知情的情况下，通过若干技术拦截并将流量导入代理服务器
3. 修改DNS的命名空间
4. 修改Web服务器 --- 服务器返回重定向的响应到客户端，客户端重新发起到代理服务器的请求

### 如何配置浏览器来使用代理

1. 手工配置
2. 预先配置浏览器
3. 代理的自动配置
4. WPAD的代理发现

### 展示HTTP的代理请求，说明代理与服务器请求的区别

客户端没有设置代理时，向Web服务器发送请求时，请求行包含部分URI   
客户端设置代理时，向代理服务器发送请求时，请求行包含完整的URI

### 代理是如何微妙的改变浏览器行为

有显示代理的URI的解析，浏览器添加默认方案和路径，不对URI进行自动扩展和主机名解析，这些工作交由代理完成   
使用拦截代理时，浏览器无法检测出已停用服务器的IP地址

### 如何通过via首部和trace方法来记录报文传输路径上的代理服务器链

Via首部字段列出了与报文途径的每个中间节点（网关或代理）有关的信息   

使用TRACE方法，用户可以跟踪经代理链传输的请求报文，观察报文经过了那些代理，以及每个代理是如何对请求报文进行修改的

### 描述基于代理的HTTP访问控制方法

Max-Forwards 首部限制TRACE 和 OPTIONS 请求所能经过的代理服务器个数

### 解释代理如何与客户端和服务器进行交互

代理必须对不认识的首部字段进行转发，而且必须维持同名首部字段的相对顺序   
代理即使无法理解指定的所有方法，也不能多Allow首部字段进行修改